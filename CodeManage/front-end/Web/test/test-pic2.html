<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
</head>

<body>
    <video src=""></video>
    <button id="snap">Snap Photo</button>
    <canvas id="canvas" width="640" height="480"></canvas>

    <script type="text/javascript">
        var opt = {
            audio: true,
            video: {
                width: 375,
                height: 375
            }
        };
        navigator.mediaDevices.getUserMedia(opt)
            .then(function (mediaStream) {
                var video = document.querySelector('video');
                video.srcObject = mediaStream;
                video.onloadedmetadata = function (e) {
                    video.play();
                };
            })
            .catch(function (err) {
                console.log(err.name + ": " + err.message);
            }); // always check for errors at the end.
    </script>
    <script>
        document.getElementById("snap").addEventListener("click", function () {
            alert("start");
            var videoEle = document.querySelector('video');
            canvas.getContext('2d').drawImage(videoEle, 0, 0, canvas.width, canvas.height);
            alert(canvas.toDataURL("image/png"));
            // var img = document.createElement("img");
            // img.src = canvas.toDataURL("image/png");
            // $("#out-box").html(img);
            // URL.revokeObjectURL(this.src); // 释放createObjectURL创建的对象
            // // ctx.drawImage(aVideo, 0, 0, 640, 480); //将获取视频绘制在画布上
            alert("owari");
        });
    </script>

</body>

</html>